<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Caspar's AI æ¯æ—¥ç²¾é€‰</title>
  <script type="module" src="https://cdn.jsdelivr.net/gh/zerodevx/zero-md@2/dist/zero-md.min.js"></script>
  <style>
    body { 
      max-width: 800px; 
      margin: 0 auto; 
      padding: 20px; 
      background: #f4f5f7; 
      font-family: system-ui, -apple-system, sans-serif;
    }
    
    /* é¡¶éƒ¨å¯¼èˆªå®¹å™¨ */
    .header { 
      display: flex; 
      flex-direction: column;
      align-items: center; 
      margin-bottom: 30px; 
    }
    .header h2 { 
      margin: 0 0 20px 0; 
      color: #333; 
      font-size: 1.5rem;
    }

    /* æ—¥æœŸåˆ‡æ¢å™¨ç»„ - è¿˜åŸæˆªå›¾é£æ ¼ */
    .nav-group {
      display: flex;
      align-items: center;
      gap: 12px;
      background: white;
      padding: 12px 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.03);
    }

    /* å·¦å³æ§åˆ¶æŒ‰é’® */
    .nav-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border: 1px solid #eaeaea;
      background: #fafafa;
      border-radius: 6px;
      cursor: pointer;
      color: #c88181; /* æˆªå›¾ä¸­çš„ç®­å¤´é¢œè‰² */
      font-size: 18px;
      font-weight: bold;
      transition: all 0.2s ease;
    }
    .nav-btn:hover:not(:disabled) {
      background: #fff;
      border-color: #d89999;
      box-shadow: 0 0 10px rgba(100, 150, 255, 0.2); /* æˆªå›¾å³ä¾§é‚£éšçº¦çš„è“è‰²å…‰æ™•æ•ˆæœ */
    }
    .nav-btn:disabled {
      color: #ccc;
      cursor: not-allowed;
      background: #f5f5f5;
    }

    /* åŸç”Ÿæ—¥å†è¾“å…¥æ¡†ç¾åŒ– */
    input[type="date"] { 
      padding: 8px 12px; 
      border: 1px solid #eaeaea; 
      border-radius: 6px; 
      font-size: 16px; 
      font-family: monospace;
      color: #333;
      cursor: pointer;
      outline: none;
      background: #fff;
      font-weight: 500;
    }
    input[type="date"]:hover {
      border-color: #ccc;
    }
    
    /* Markdown å®¹å™¨ */
    zero-md { 
      background: white; 
      padding: 30px; 
      border-radius: 8px; 
      box-shadow: 0 4px 6px rgba(0,0,0,0.05); 
    }
    
    /* æç®€é”™è¯¯æç¤º */
    .error-msg { 
      color: #888; 
      padding: 40px; 
      text-align: center; 
      font-size: 16px;
      display: none; 
    }
  </script>
</head>
<body>

  <div class="header">
    <h2>ğŸ“° AI æ¯æ—¥æŠ€æœ¯ç²¾é€‰</h2>
    <div class="nav-group">
      <button class="nav-btn" id="prev-btn" title="å‰ä¸€å¤©">â†</button>
      <input type="date" id="history-date">
      <button class="nav-btn" id="next-btn" title="åä¸€å¤©">â†’</button>
    </div>
  </div>

  <div id="error-msg" class="error-msg">
    è¯¥æ—¥æœŸæ²¡æœ‰æ—¥æŠ¥
  </div>

  <zero-md id="md-viewer" src="digest.md"></zero-md>

  <script>
    const dateInput = document.getElementById('history-date');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const mdViewer = document.getElementById('md-viewer');
    const errorMsg = document.getElementById('error-msg');

    // å·¥å…·å‡½æ•°ï¼šè·å–æ ¼å¼åŒ–çš„æœ¬åœ°æ—¥æœŸ (YYYY-MM-DD)
    function getLocalDateString(dateObj) {
      const offset = dateObj.getTimezoneOffset() * 60000;
      return new Date(dateObj.getTime() - offset).toISOString().split('T')[0];
    }

    const localTodayStr = getLocalDateString(new Date());
    
    // åˆå§‹åŒ–æ—¥æœŸé€‰æ‹©å™¨
    dateInput.max = localTodayStr;
    dateInput.value = localTodayStr; // é»˜è®¤æ˜¾ç¤ºä»Šå¤©

    // æ›´æ–°æŒ‰é’®çŠ¶æ€ï¼ˆä»Šå¤©ä¸èƒ½ç‚¹"ä¸‹ä¸€å¤©"ï¼‰
    function updateBtnState() {
      nextBtn.disabled = dateInput.value >= localTodayStr;
    }

    // æ ¸å¿ƒåŠ è½½é€»è¾‘
    async function loadDigest(dateStr) {
      if (!dateStr) return;
      updateBtnState();

      // å¦‚æœé€‰çš„æ˜¯ä»Šå¤©ï¼Œä¼˜å…ˆå°è¯•åŠ è½½æ ¹ç›®å½•çš„æœ€æ–°ç‰ˆï¼Œä¿è¯ä¸‡æ— ä¸€å¤±
      let targetFile = 'digest.md';
      
      // å¦‚æœä¸æ˜¯ä»Šå¤©ï¼Œå» archives æ–‡ä»¶å¤¹æ‰¾å†å²å½’æ¡£
      if (dateStr !== localTodayStr) {
        const formattedDate = dateStr.replace(/-/g, ''); // å˜æˆ 20260219
        targetFile = `archives/digest-${formattedDate}.md`;
      }

      try {
        // å…ˆå‘é€ HEAD è¯·æ±‚ç¡®è®¤æ–‡ä»¶å­˜åœ¨
        const response = await fetch(targetFile, { method: 'HEAD' });
        if (response.ok) {
          errorMsg.style.display = 'none';
          mdViewer.style.display = 'block';
          mdViewer.src = targetFile;
        } else {
          // å¦‚æœæ ¹ç›®å½•æ‰¾ä¸åˆ°ä»Šå¤©çš„ï¼Œå°è¯•æ‰¾ä»Šå¤©å¯¹åº”çš„ archive æ–‡ä»¶
          if (dateStr === localTodayStr) {
            const formattedToday = localTodayStr.replace(/-/g, '');
            const fallbackFile = `archives/digest-${formattedToday}.md`;
            const fallbackResp = await fetch(fallbackFile, { method: 'HEAD' });
            if (fallbackResp.ok) {
              errorMsg.style.display = 'none';
              mdViewer.style.display = 'block';
              mdViewer.src = fallbackFile;
              return;
            }
          }
          mdViewer.style.display = 'none';
          errorMsg.style.display = 'block';
        }
      } catch (error) {
        mdViewer.style.display = 'none';
        errorMsg.style.display = 'block';
      }
    }

    // ç›‘å¬äº‹ä»¶ï¼šæ—¥å†æ‰‹åŠ¨æ”¹å˜
    dateInput.addEventListener('change', (e) => {
      loadDigest(e.target.value);
    });

    // ç›‘å¬äº‹ä»¶ï¼šå‰ä¸€å¤©
    prevBtn.addEventListener('click', () => {
      const current = new Date(dateInput.value);
      current.setDate(current.getDate() - 1);
      dateInput.value = getLocalDateString(current);
      loadDigest(dateInput.value);
    });

    // ç›‘å¬äº‹ä»¶ï¼šåä¸€å¤©
    nextBtn.addEventListener('click', () => {
      const current = new Date(dateInput.value);
      current.setDate(current.getDate() + 1);
      dateInput.value = getLocalDateString(current);
      loadDigest(dateInput.value);
    });

    // é¡µé¢é¦–æ¬¡åŠ è½½æ—¶åˆå§‹åŒ–æŒ‰é’®çŠ¶æ€
    updateBtnState();
  </script>

</body>
</html>
